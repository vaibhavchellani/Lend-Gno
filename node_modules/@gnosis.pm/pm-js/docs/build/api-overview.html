

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>API Overview &mdash; pm-js  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="pm-js  documentation" href="index.html"/>
        <link rel="next" title="Events, Oracles and Markets" href="events-oracles-and-markets.html"/>
        <link rel="prev" title="Installation" href="installation.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> pm-js
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">API Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#note-about-promises">Note about Promises</a></li>
<li class="toctree-l2"><a class="reference internal" href="#truffle-contract-abstractions">Truffle contract abstractions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#note-about-async-and-await">Note about <code class="docutils literal notranslate"><span class="pre">async</span></code> and <code class="docutils literal notranslate"><span class="pre">await</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#wrapping-common-operations">Wrapping common operations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#web3-options">Web3 options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gas-estimations">Gas estimations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#advanced-notes-for-developers-who-use-web3">(Advanced) Notes for developers who use <code class="docutils literal notranslate"><span class="pre">web3</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="events-oracles-and-markets.html">Events, Oracles and Markets</a></li>
<li class="toctree-l1"><a class="reference internal" href="lmsr-primer.html">LMSR Primer</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing-guide.html">Contributing Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-reference.html">API Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pm-js</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>API Overview</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/api-overview.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="api-overview">
<span id="api-overview"></span><h1>API Overview<a class="headerlink" href="#api-overview" title="Permalink to this headline">¶</a></h1>
<p>The pm-js library is encapsulated inside of the <a class="reference external" href="api-reference.html#Gnosis">Gnosis</a> class. In order for it to function, it must be connected to an Ethereum network through a <a class="reference external" href="https://github.com/ethereum/wiki/wiki/JavaScript-API">Web3.js</a> interface. It also uses <a class="reference external" href="https://ipfs.io/">IPFS</a> for publishing and retrieving event data, and so it will also have to be connected to an IPFS node. Configuration of these connections can be done with a call to the asynchronous factory function <a class="reference external" href="api-reference.html#Gnosis.create">Gnosis.create</a>. For example, the following code will store an instance of the pm-js library into the variable <code class="docutils literal notranslate"><span class="pre">gnosis</span></code>:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">gnosis</span>

<span class="nx">Gnosis</span><span class="p">.</span><span class="nx">create</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">gnosis</span> <span class="o">=</span> <span class="nx">result</span>
    <span class="c1">// gnosis is available here and may be used</span>
<span class="p">})</span>

<span class="c1">// note that gnosis is NOT guaranteed to be initialized outside the callback scope here</span>
</pre></div>
</div>
<div class="section" id="note-about-promises">
<span id="note-about-promises"></span><h2>Note about Promises<a class="headerlink" href="#note-about-promises" title="Permalink to this headline">¶</a></h2>
<p>Because of the library’s dependence on remote service providers and the necessity to wait for transactions to complete on the blockchain, the majority of the methods in the API are asynchronous and return thenables in the form of <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises">Promises</a>.</p>
</div>
<div class="section" id="truffle-contract-abstractions">
<span id="truffle-contract-abstractions"></span><h2>Truffle contract abstractions<a class="headerlink" href="#truffle-contract-abstractions" title="Permalink to this headline">¶</a></h2>
<p>pm-js also relies on <a class="reference external" href="https://github.com/trufflesuite/truffle-contract">Truffle contract abstractions</a>. In fact, much of the underlying core contract functionality can be accessed in pm-js as one of these abstractions. Since the Truffle contract wrapper has to perform asynchronous actions such as wait on the result of a remote request to an Ethereum RPC node, it also uses thenables. For example, here is how to use the on-chain Gnosis <a class="reference external" href="https://gnosis-pm-contracts.readthedocs.io/en/latest/Math.html">Math</a> library exposed at <a class="reference external" href="api-reference.html#Gnosis.contracts">Gnosis.contracts</a> to print the approximate natural log of a number:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">ONE</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
<span class="nx">Gnosis</span><span class="p">.</span><span class="nx">create</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">gnosis</span> <span class="p">=&gt;</span> <span class="nx">gnosis</span><span class="p">.</span><span class="nx">contracts</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">deployed</span><span class="p">())</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">math</span> <span class="p">=&gt;</span> <span class="nx">math</span><span class="p">.</span><span class="nx">ln</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="nx">ONE</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Math.ln(3) =&#39;</span><span class="p">,</span> <span class="nx">result</span><span class="p">.</span><span class="nx">valueOf</span><span class="p">()</span> <span class="o">/</span> <span class="nx">ONE</span><span class="p">))</span>
</pre></div>
</div>
<div class="section" id="note-about-async-and-await">
<span id="note-about-async-and-await"></span><h3>Note about <code class="docutils literal notranslate"><span class="pre">async</span></code> and <code class="docutils literal notranslate"><span class="pre">await</span></code><a class="headerlink" href="#note-about-async-and-await" title="Permalink to this headline">¶</a></h3>
<p>Although it is not strictly necessary, usage of <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function"><code class="docutils literal notranslate"><span class="pre">async/await</span></code></a> syntax is encouraged for simplifying the use of thenable programming, especially in complex flow scenarios. To increase the readability of code examples from this point forward, this guide will assume <code class="docutils literal notranslate"><span class="pre">async/await</span></code> is available and snippets execute in the context of an <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function"><code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">function</span></code></a>. With those assumptions, the previous example can be expressed in an <code class="docutils literal notranslate"><span class="pre">async</span></code> context like so:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">ONE</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">gnosis</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Gnosis</span><span class="p">.</span><span class="nx">create</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">math</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">gnosis</span><span class="p">.</span><span class="nx">contracts</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">deployed</span><span class="p">()</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Math.ln(3) =&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">await</span> <span class="nx">math</span><span class="p">.</span><span class="nx">ln</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="nx">ONE</span><span class="p">)).</span><span class="nx">valueOf</span><span class="p">()</span> <span class="o">/</span> <span class="nx">ONE</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="wrapping-common-operations">
<span id="wrapping-common-operations"></span><h2>Wrapping common operations<a class="headerlink" href="#wrapping-common-operations" title="Permalink to this headline">¶</a></h2>
<p>pm-js also exposes a number of convenience methods wrapping contract operations such as <a class="reference external" href="api-reference.html#createCentralizedOracle">Gnosis.createCentralizedOracle</a> and <a class="reference external" href="api-reference.html#createScalarEvent">Gnosis.createScalarEvent</a>.</p>
<div class="section" id="web3-options">
<span id="web3-options"></span><h3>Web3 options<a class="headerlink" href="#web3-options" title="Permalink to this headline">¶</a></h3>
<p>The methods on the API can be provided with <code class="docutils literal notranslate"><span class="pre">from</span></code>, <code class="docutils literal notranslate"><span class="pre">to</span></code>, <code class="docutils literal notranslate"><span class="pre">value</span></code>, <code class="docutils literal notranslate"><span class="pre">gas</span></code>, and <code class="docutils literal notranslate"><span class="pre">gasPrice</span></code> options which get passed down to the <code class="docutils literal notranslate"><span class="pre">web3.js</span></code> layer. For example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">await</span> <span class="nx">gnosis</span><span class="p">.</span><span class="nx">createCentralizedOracle</span><span class="p">({</span>
    <span class="nx">ipfsHash</span><span class="o">:</span> <span class="s1">&#39;Qm...&#39;</span><span class="p">,</span>
    <span class="nx">gasPrice</span><span class="o">:</span> <span class="mi">20</span><span class="nx">e9</span><span class="p">,</span> <span class="c1">// 20 GWei</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
<div class="section" id="gas-estimations">
<span id="gas-estimations"></span><h3>Gas estimations<a class="headerlink" href="#gas-estimations" title="Permalink to this headline">¶</a></h3>
<p>Many of the methods on the gnosis API also have an asynchronous <code class="docutils literal notranslate"><span class="pre">estimateGas</span></code> property which you can use, while allowing you to specify the gas estimation source. For example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// using the estimateGas RPC</span>
<span class="nx">await</span> <span class="nx">gnosis</span><span class="p">.</span><span class="nx">createCentralizedOracle</span><span class="p">.</span><span class="nx">estimateGas</span><span class="p">(</span><span class="nx">ipfsHash</span><span class="p">,</span> <span class="p">{</span> <span class="nx">using</span><span class="o">:</span> <span class="s1">&#39;rpc&#39;</span> <span class="p">}))</span>

<span class="c1">// using stats derived from pm-contracts</span>
<span class="nx">await</span> <span class="nx">gnosis</span><span class="p">.</span><span class="nx">createCentralizedOracle</span><span class="p">.</span><span class="nx">estimateGas</span><span class="p">({</span> <span class="nx">using</span><span class="o">:</span> <span class="s1">&#39;stats&#39;</span> <span class="p">}))</span>
</pre></div>
</div>
<p>The gas stats derived from <code class="docutils literal notranslate"><span class="pre">pm-contracts</span></code> and used by the <code class="docutils literal notranslate"><span class="pre">estimateGas</span></code> functions when using stats are also added to the contract abstractions in the following property:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// examples of objects with gas stats for each function derived from pm-contracts test suite</span>
<span class="nx">gnosis</span><span class="p">.</span><span class="nx">contracts</span><span class="p">.</span><span class="nx">CentralizedOracle</span><span class="p">.</span><span class="nx">gasStats</span>
<span class="nx">gnosis</span><span class="p">.</span><span class="nx">contracts</span><span class="p">.</span><span class="nx">ScalarEvent</span><span class="p">.</span><span class="nx">gasStats</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="advanced-notes-for-developers-who-use-web3">
<span id="advanced-notes-for-developers-who-use-web3"></span><h2>(Advanced) Notes for developers who use <code class="docutils literal notranslate"><span class="pre">web3</span></code><a class="headerlink" href="#advanced-notes-for-developers-who-use-web3" title="Permalink to this headline">¶</a></h2>
<p>If you would like to continue using <code class="docutils literal notranslate"><span class="pre">web3</span></code> directly, one option is to skip this repo and use the <a class="reference external" href="https://github.com/gnosis/pm-contracts">core contracts</a> directly. The NPM package <code class="docutils literal notranslate"><span class="pre">&#64;gnosis.pm/pm-contracts</span></code> contains Truffle build artifacts as <code class="docutils literal notranslate"><span class="pre">build/contracts/*.json</span></code>, and those in turn contain contract ABIs, as well as existing deployment locations for various networks. The usage at this level looks something like this:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">Web3</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web3&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">CategoricalEventArtifact</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@gnosis.pm/pm-contracts/build/contracts/CategoricalEvent.json&#39;</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">web3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Web3</span><span class="p">(</span><span class="cm">/* whatever your web3 setup is here... */</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">eventWeb3Contract</span> <span class="o">=</span> <span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">contract</span><span class="p">(</span><span class="nx">CategoricalEventArtifact</span><span class="p">.</span><span class="nx">abi</span><span class="p">,</span> <span class="s1">&#39;0x0bf128753dB586f742eaAda502301ea86a7561e6&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Truffle build artifacts are compatible with <a class="reference external" href="https://github.com/trufflesuite/truffle-contract"><code class="docutils literal notranslate"><span class="pre">truffle-contract</span></code></a>, which wraps <a class="reference external" href="https://github.com/ethereum/wiki/wiki/JavaScript-API#web3ethcontract"><code class="docutils literal notranslate"><span class="pre">web3.eth.contract</span></code></a> functionality and provides additional features. If you’d like to take advantage of these features without pm-js, you may use <code class="docutils literal notranslate"><span class="pre">truffle-contract</span></code> in the following way:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">Web3</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web3&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">contract</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;truffle-contract&#39;</span><span class="p">)</span>

<span class="c1">// unlike the last setup, we don&#39;t need web3, just </span>
<span class="kr">const</span> <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Web3</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">HttpProvider</span><span class="p">(</span><span class="s1">&#39;https://ropsten.infura.io&#39;</span><span class="p">)</span> <span class="c1">// or whatever provider you&#39;d like</span>

<span class="kr">const</span> <span class="nx">CategoricalEventArtifact</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@gnosis.pm/pm-contracts/build/contracts/CategoricalEvent.json&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">CategoricalEvent</span> <span class="o">=</span> <span class="nx">contract</span><span class="p">(</span><span class="nx">CategoricalEventArtifact</span><span class="p">)</span> <span class="c1">// pass in the artifact directly here instead</span>
<span class="kr">const</span> <span class="nx">CategoricalEvent</span><span class="p">.</span><span class="nx">setProvider</span><span class="p">(</span><span class="nx">provider</span><span class="p">)</span>

<span class="c1">// this is asynchronous because this is how truffle-contract recommends you use .at</span>
<span class="c1">// since in the asynchronous version, truffle-contract will actually check to make sure that</span>
<span class="c1">// the bytecode at the address matches the bytecode specified in the artifact</span>
<span class="kr">const</span> <span class="nx">eventTruffleContract</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">CategoricalEvent</span><span class="p">.</span><span class="nx">at</span><span class="p">(</span><span class="s1">&#39;0x0bf128753dB586f742eaAda502301ea86a7561e6&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>With pm-js, you may accomplish the above with:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">gnosis</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Gnosis</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span> <span class="nx">ethereum</span><span class="o">:</span> <span class="nx">web3</span><span class="p">.</span><span class="nx">currentProvider</span> <span class="p">})</span>
<span class="kr">const</span> <span class="nx">event</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">gnosis</span><span class="p">.</span><span class="nx">contracts</span><span class="p">.</span><span class="nx">CategoricalEvent</span><span class="p">.</span><span class="nx">at</span><span class="p">(</span><span class="s1">&#39;0x0bf128753dB586f742eaAda502301ea86a7561e6&#39;</span><span class="p">)</span>
<span class="c1">// and then for example</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">await</span> <span class="nx">event</span><span class="p">.</span><span class="nx">isOutcomeSet</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="events-oracles-and-markets.html" class="btn btn-neutral float-right" title="Events, Oracles and Markets" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="installation.html" class="btn btn-neutral" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Gnosis.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>