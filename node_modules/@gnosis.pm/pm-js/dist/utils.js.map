{"version":3,"sources":["../src/utils.js"],"names":["opts","caller","txHash","txResult","matchingLog","callerContract","deployed","methodName","sendTransaction","methodArgs","log","formatCallSignature","constructor","syncTransaction","requireEventFromTXResult","eventName","resultContract","args","eventArgName","slice","contractName","at","TransactionError","subError","sendTransactionAndGetResult","normalizeWeb3Args","wrapWeb3Function","promisify","promisifyAll","makeWeb3Compatible","value","type","argName","Error","match","exec","length","Number","map","v","address","test","bytesLength","startsWith","signed","numBits","valueOf","toString","getOptsFromArgs","getTruffleArgsWhileMutatingOptions","argInfo","argAliases","name","alias","ret","Decimal","DecimalJS","clone","precision","toExpPos","functionInputs","defaults","methodOpts","i","join","getWeb3CallMetadata","speccedOpts","callerABI","validators","abi","functionCandidates","filter","console","warn","pop","inputs","forEach","validator","push","spec","wrappedFn","callMetadata","estimateGas","using","gasStats","averageGasUsed","result","matchingLogs","logs","l","event","tx","e","fn","Proxy","apply","target","thisArg","resolve","reject","newArgs","err","obj","fnName","asyncFnName"],"mappings":"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","file":"utils.js","sourcesContent":["import _ from 'lodash'\nimport DecimalJS from 'decimal.js'\n\nfunction makeWeb3Compatible(value, type, argName) {\n    if(type == null) {\n        throw new Error(`type must be specified for argument ${argName}`)\n    }\n\n    let match = /^(.*)\\[(\\d*)\\]$/.exec(type)\n    if(match != null) {\n        if(!_.isArray(value)) {\n            throw new Error(`expected ${value} to be convertable to ${type} ${argName}`)\n        }\n\n        if(match[2] !== '' && value.length !== Number(match[2])) {\n            throw new Error(`${value} has ${value.length} items but should be ${type} ${argName}`)\n        }\n\n        return value.map((v) => makeWeb3Compatible(v, match[1], argName))\n    }\n\n    if(type === 'address') {\n        // if it quacks like a TruffleContract\n        if (_.has(value, 'address')) {\n            value = value.address\n        }\n\n        if(!_.isString(value)) {\n            throw new Error(`${value} must be string for ${type} ${argName}`)\n        }\n\n        if(!/^(0x)?[0-9a-f]{40}$/i.test(value)) {\n            throw new Error(`${value} has wrong format for ${type} ${argName}`)\n        }\n\n        return value\n    }\n\n    if(type === 'bool') {\n        if(!_.isBoolean(value)) {\n            throw new Error(`expected ${value} to be a bool for ${type} ${argName}`)\n        }\n\n        return value\n    }\n\n    if(type === 'bytes' || type === 'string') {\n        if(_.isString(value)) {\n            return value\n        }\n\n        throw new Error(`could not format ${value} for ${type} ${argName}`)\n    }\n\n    match = /^bytes(\\d+)$/.exec(type)\n    if(match != null) {\n        let bytesLength = Number(match[1])\n        if(bytesLength > 32 || bytesLength === 0 || match[1].startsWith('0')) {\n            throw new Error(`invalid type ${type} specified for ${argName}`)\n        }\n\n        if(_.isString(value)) {\n            // TODO: refine this check to account for things like '\\uACDC'.length\n            if(value.length > bytesLength) {\n                throw new Error(`value ${value} too long for ${type} ${argName}`)\n            }\n            return value\n        }\n\n        throw new Error(`could not format ${value} for ${type} ${argName}`)\n    }\n\n    match = /^(u?)int(\\d+)$/.exec(type)\n    if(match != null) {\n        let signed = match[1] === ''\n        let numBits = Number(match[2])\n        if(numBits % 8 !== 0) {\n            throw new Error(`number of bits for ${type} ${argName} not divisible by 8`)\n        }\n\n        if(numBits > 256) {\n            throw new Error(`number of bits for ${type} ${argName} is too large`)\n        }\n\n        value = value.valueOf()\n\n        if(_.isString(value) && /^-?(0x[\\da-f]+|\\d+)$/i.test(value) || _.isNumber(value)) {\n            if(\n                _.isString(value) && value.startsWith('0x') &&\n                value.slice(2) === Number(value).toString(16) ||\n                value == Number(value).toString()\n            ) {\n                value = Number(value)\n            }\n\n            if(!signed && value.toString().startsWith('-')) {\n                throw new Error(`cannot pass negative value ${value} for ${type} ${argName}`)\n            }\n\n            return value\n        }\n\n        throw new Error(`could not normalize ${value} for ${type} ${argName}`)\n    }\n\n    throw new Error(`unsupported type ${type} for ${argName}`)\n}\n\nfunction getOptsFromArgs(args) {\n    return typeof args[args.length - 1] === 'object' ? args[args.length - 1] : {}\n}\n\nfunction getTruffleArgsWhileMutatingOptions (argInfo, opts, argAliases) {\n    opts = opts == null ? {} : opts\n\n    if(argAliases != null) {\n        _.forOwn(argAliases, (name, alias) => {\n            if(_.has(opts, alias)) {\n                if(_.has(opts, name)) {\n                    throw new Error(`both name ${name} and its alias ${alias} specified in ${opts}`)\n                }\n                opts[name] = opts[alias]\n                delete opts[alias]\n            }\n        })\n    }\n\n    return argInfo.map(({ name, type }) => {\n        if (!_.has(opts, name)) {\n            throw new Error(`missing argument ${name}`)\n        }\n        const ret = makeWeb3Compatible(opts[name], type, name)\n        delete opts[name]\n        return ret\n    })\n}\n\nexport let Decimal = DecimalJS.clone({ precision: 80, toExpPos: 9999 })\n\nexport function normalizeWeb3Args(args, opts) {\n    let {\n        functionInputs, methodName, argAliases, defaults\n    } = opts\n\n    // Format arguments in a way that web3 likes\n    let methodArgs, methodOpts\n    if(functionInputs.length === 1 && args.length === 1) {\n        // if there is one input, user could have supplied either the argument with no options\n        // or the argument inside of an options object\n        if(typeof args[0] === 'object' && _.has(args[0], functionInputs[0].name)) {\n            // we consider argument to be an options object if it has the parameter name as a key on it\n            methodOpts = _.defaults(_.clone(args[0]), defaults)\n            methodArgs = getTruffleArgsWhileMutatingOptions(functionInputs, methodOpts, argAliases)\n        } else {\n            methodOpts = null\n            methodArgs = functionInputs.map(({ name, type }, i) => makeWeb3Compatible(args[i], type, name))\n        }\n    } else if(functionInputs.length === args.length) {\n        methodOpts = null\n        methodArgs = functionInputs.map(({ name, type }, i) => makeWeb3Compatible(args[i], type, name))\n    } else if(functionInputs.length + 1 === args.length && typeof args[functionInputs.length] === 'object') {\n        methodOpts = args[args.length - 1]\n        // this map should not hit the last element of args\n        methodArgs = functionInputs.map(({ name, type }, i) => makeWeb3Compatible(args[i], type, name))\n    } else if(args.length === 1 && typeof args[0] === 'object') {\n        methodOpts = _.defaults(_.clone(args[0]), defaults)\n        methodArgs = getTruffleArgsWhileMutatingOptions(functionInputs, methodOpts, argAliases)\n    } else {\n        throw new Error(`${methodName}(${\n            functionInputs.map(({ name, type }) => `${type} ${name}`).join(', ')\n        }) can't be called with args (${args.join(', ')})`)\n    }\n\n    return [methodArgs, methodOpts]\n}\n\nfunction getWeb3CallMetadata(args, opts, speccedOpts) {\n    let {\n        callerContract, callerABI, methodName,\n        eventName, eventArgName, resultContract,\n        argAliases, validators\n    } = speccedOpts\n\n    if(callerABI == null) {\n        callerABI = callerContract.abi\n    }\n\n    const functionCandidates = callerABI.filter(({ name }) => name === methodName)\n\n    if(functionCandidates.length === 0) {\n        throw new Error(`could not find function ${methodName} in abi ${callerABI}`)\n    } else if(functionCandidates.length > 1) {\n        // eslint-disable-next-line no-console\n        console.warn(`function ${methodName} has multiple candidates in abi ${callerABI} -- using last candidate`)\n    }\n\n    const functionInputs = functionCandidates.pop().inputs\n\n    let [methodArgs, methodOpts] = normalizeWeb3Args(args, { functionInputs, methodName, argAliases })\n\n    if(validators != null) {\n        validators.forEach((validator) => { validator(methodArgs) })\n    }\n\n    // Pass extra options down to the web3 layer\n    if(methodOpts != null) {\n        methodArgs.push(methodOpts)\n    }\n\n    return {\n        callerContract, methodName, methodArgs,\n        eventName, eventArgName, resultContract,\n    }\n}\n\nexport function wrapWeb3Function(spec) {\n    const wrappedFn = async function() {\n        const opts = getOptsFromArgs(arguments)\n        const speccedOpts = spec(this, opts)\n        const callMetadata = getWeb3CallMetadata(arguments, opts, speccedOpts)\n        callMetadata.log = this.log\n\n        return await sendTransactionAndGetResult(callMetadata)\n    }\n\n    wrappedFn.estimateGas = async function() {\n        const opts = getOptsFromArgs(arguments)\n        const speccedOpts = spec(this, opts)\n        const { callerContract, methodName } = speccedOpts\n\n        if(opts.using === 'stats') {\n            return callerContract.gasStats[methodName].averageGasUsed\n        }\n\n        if(opts.using === 'rpc') {\n            const { methodArgs } = getWeb3CallMetadata(arguments, opts, speccedOpts)\n\n            let caller = callerContract\n            if (_.has(caller, 'deployed')) {\n                caller = await caller.deployed()\n            }\n\n            return await caller[methodName].estimateGas(...methodArgs)\n        }\n\n        throw new Error(`unsupported gas estimation source ${opts.using}`)\n    }\n\n    return wrappedFn\n}\n\n/**\n * Looks for a single event in the logs of a transaction result. If no such events or multiple matching events are found, throws an error. Otherwise returns the matching event log.\n *\n * @param {Transaction} result Result of sending a transaction\n * @param {string} eventName Name of the event\n * @return {Object} The matching event log found\n * @alias Gnosis.requireEventFromTXResult\n */\nexport function requireEventFromTXResult (result, eventName) {\n    let matchingLogs = _.filter(result.logs, (l) => l.event === eventName)\n\n    if (matchingLogs.length < 1) {\n        throw new Error(`could not find any logs in transaction ${result.tx} corresponding to event ${eventName}`)\n    } else if (matchingLogs.length > 1) {\n        throw new Error(`found too many logs in transaction ${result.tx} corresponding to event ${eventName}`)\n    }\n\n    return matchingLogs[0]\n}\n\nexport function formatCallSignature(opts) {\n    return `${\n        opts.caller.constructor.contractName\n    }(${opts.caller.address.slice(0, 6)}..${opts.caller.address.slice(-4)}).${opts.methodName}(${\n        opts.methodArgs.map(v => {\n            try {\n                return JSON.stringify(v)\n            } catch(e) {\n                return v\n            }\n        }).join(', ')\n    })`\n}\n\nexport class TransactionError extends Error {\n    constructor(opts) {\n        super(`${formatCallSignature(opts)}${opts.txHash == null ? '' : `\n\n  with transaction hash ${opts.txHash}`}\n\n  failed with ${opts.subError}`)\n\n        Object.assign(this, opts)\n\n        this.name = 'TransactionError'\n    }\n}\n\nexport async function sendTransactionAndGetResult (opts) {\n    opts = opts || {}\n    let caller, txHash, txResult, matchingLog\n\n    try {\n        caller = opts.callerContract\n        if (_.has(caller, 'deployed')) {\n            caller = await caller.deployed()\n        }\n\n        txHash = await caller[opts.methodName].sendTransaction(...opts.methodArgs)\n\n        if(opts.log != null) {\n            opts.log(`got tx hash ${txHash} for call ${\n                formatCallSignature({ caller, methodName: opts.methodName, methodArgs: opts.methodArgs })\n            }`)\n        }\n\n        txResult = await caller.constructor.syncTransaction(txHash)\n        matchingLog = requireEventFromTXResult(txResult, opts.eventName)\n\n        if(opts.resultContract == null) {\n            return matchingLog.args[opts.eventArgName]\n        } else {\n            opts.log(`tx hash ${txHash.slice(0, 6)}..${txHash.slice(-4)} returned ${opts.resultContract.contractName}(${matchingLog.args[opts.eventArgName]})`)\n            return await opts.resultContract.at(matchingLog.args[opts.eventArgName])\n        }\n    } catch(err) {\n        throw new TransactionError(Object.assign({\n            caller, txHash, txResult, matchingLog,\n            subError: err,\n        }, opts))\n    }\n}\n\n// I know bluebird does this, but it's heavy\n// Also, as of Node v8.5.0, `util.promisify` doesn't call the function with the same `this`\nexport function promisify (fn) {\n    return new Proxy(fn, {\n        apply: (target, thisArg, args) => {\n            return new Promise((resolve, reject) => {\n                let newArgs = Array.from(args)\n                newArgs.push((err, result) => {\n                    if (err != null) {\n                        reject(new Error(`${err}${result == null ? '' : ` (${result})`}`))\n                    } else {\n                        resolve(result)\n                    }\n                })\n                target.apply(thisArg, newArgs)\n            })\n        }\n    })\n}\n\nexport function promisifyAll (obj) {\n    _.functionsIn(obj).forEach((fnName) => {\n        let asyncFnName = fnName + 'Async'\n        if (!_.has(obj, asyncFnName)) {\n            obj[asyncFnName] = promisify(obj[fnName])\n        }\n    })\n    return obj\n}\n"]}